<!DOCTYPE html>
{% load static %}
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Tersirat</title>

        {% include "css.html" %}
    </head>
    <body>
        <div class="bg-img-100">
            <div class="text-center" style="padding-top:50vh">

                <span class="badge badge-success">{{count.count__sum}}</span>
                
                <!-- buat ngeprint index yg spesifik -->
                <span class="badge badge-success">{{count_all.1.creation_time}}</span>
                
                <!-- looping semua langsung -->
                {% for c in count_all %}
                    <span class="badge badge-success">{{c.creation_time}}</span>
                {%  endfor %}
                

                <form id="form-count">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary text-center my-auto">SIRATKAN</button>
                </form>

            </div>
        </div>
    </body>
</html>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

<script>

    $(document).on("submit", "form", function(e){
        e.preventDefault();
        var now = new Date();
        var formData = new FormData(this);
        formData.append('count',1);

        var object = {};
        formData.forEach((value, key) => object[key] = value);
        var json = JSON.stringify(object);

        console.log(json);
        var csrftoken = $("[name=csrfmiddlewaretoken]").val();

        $.ajax('/count', {
            type: 'POST',
            data: json,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            beforeSend: function (xhr){
                xhr.setRequestHeader('X-CSRFToken', csrftoken);
            },
            success: function (data) {
                console.log(data);
            },
            error: function (errorMessage) {
                alert('Error' + errorMessage);
            }
        });
    });

    
</script>